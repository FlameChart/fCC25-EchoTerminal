<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>EchoTerminal - automation factory</title>

        <!-- some basic style -->
        <style>
            * {
                margin: 0;
                padding: 0;
                transition: all 0.15s ease-in-out;
            }

            body {
                display: flex;
                flex-wrap: nowarp;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 0.4rem;

                font-family: "IBM Plex Mono", monospace;
                font-weight: normal;
                font-style: normal;
            }

            .bitcount {
                font-family: "Bitcount Grid Single", sans-serif;
                font-weight: normal;
                font-style: normal;
            }

            .mono {
                font-family: "IBM Plex Mono", monospace;
                font-weight: normal;
                font-style: normal;
            }
        </style>

        <!-- here is some typography style -->
        <style>
            h1 {
                font-size: 2.986rem;
            }

            h2 {
                font-size: 2.488rem;
            }

            h3 {
                font-size: 2.074rem;
            }

            p {
                font-size: 1rem;
            }
        </style>

        <!-- modern component style -->
        <style>
            button {
                border: 0;
                border-radius: 0.618rem;
                font-size: 1rem;
                padding: 0.5rem 1rem 0.45rem;
                background-color: hsl(0, 0%, 90%);
            }

            button:hover {
                background-color: hsl(0, 0%, 80%);
            }

            textarea {
                border: 0;
                font-size: 1rem;
                padding: 0.5rem 0.45rem;
                background-color: hsl(0, 0%, 90%);
                resize: none;
            }

            textarea:focus {
                outline: none;
            }

            input {
                border: 0;
                font-size: 1rem;
                padding: 0;
                background-color: transparent;
            }

            input:focus {
                outline: none;
            }
        </style>

        <!-- apply fonts -->
        <style>
            @font-face {
                font-family: "IBM Plex Mono";
                src: url("res/fonts/IBM_Plex_Mono/IBMPlexMono-Regular.ttf")
                    format("truetype");
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: "Bitcount Grid Single";
                src: url("res/fonts/Bitcount_Grid_Single/static/BitcountGridSingle-Regular.ttf")
                    format("truetype");
                font-weight: normal;
                font-style: normal;
            }
        </style>
    </head>
    <body>
        <!-- in case i need to use some SVG's -->
        <script>
            function lucide(icon) {
              switch(icon) {
                case "chevrons-down":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-down-icon lucide-chevrons-down"><path d="m7 6 5 5 5-5"/><path d="m7 13 5 5 5-5"/></svg>';
                case "chevrons-up":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-up-icon lucide-chevrons-up"><path d="m17 11-5-5-5 5"/><path d="m17 18-5-5-5 5"/></svg>';
                case "chevrons-left":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-left-icon lucide-chevrons-left"><path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/></svg>';
                case "chevrons-right":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-right-icon lucide-chevrons-right"><path d="m6 17 5-5-5-5"/><path d="m13 17 5-5-5-5"/></svg>';
                case "bot":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot-icon lucide-bot"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>';
                case "goal":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-goal-icon lucide-goal"><path d="M12 13V2l8 4-8 4"/><path d="M20.561 10.222a9 9 0 1 1-12.55-5.29"/><path d="M8.002 9.997a5 5 0 1 0 8.9 2.02"/></svg>';
                case "circle-play":
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-play-icon lucide-circle-play"><path d="M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z"/><circle cx="12" cy="12" r="10"/></svg>';
                default:
                  return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 20l-7-7h14l-7 7z"/></svg>';
              }
            }
        </script>

        <!-- Okay so for a better code organizing, I'd like to just put some const here. -->
        <script>
            // here is the define's
            // we need some "object" to contains "What is a level"
            function level(name, id, description, height, width, objects) {
                this.name = name;
                this.id = id;
                this.description = description;
                this.height = height;
                this.width = width;
                this.objects = objects;
            }

            // and here is the "blueprint" of all the game objects
            function gameObjects(
                type,
                symbol = "X",
                x,
                y,
                direction = "down",
                removable = false,
            ) {
                this.type = type;
                this.symbol = symbol;
                this.x = x;
                this.y = y;
                this.direction = direction;
                this.removable = removable;
            }

            // and here is the level lists
            const levels = [
                new level(
                    "Level 1",
                    "1",
                    "Learn the basics - Moving around",
                    5,
                    5,
                    [
                      new gameObjects("spawn", lucide('circle-play'), 2, 0),
                      new gameObjects("flag", lucide('goal'), 2, 4),
                    ],
                ),
            ];

            // just a backup of currently loading levels, for showing level info
            var loadedLevel = new level();

            // let terminal can be access lots of place
            let textarea = document.querySelector('#terminalDisplay');
        </script>
        <h1 class="bitcount">EchoTerminal - automation factory</h1>
        <p>-- inspired by Manufactoria & ShapeZ</p>
        <div
            id="container"
            style="
                display: flex;
                flex-direction: row;
                gap: 0.6rem;
                justify-content: space-between;
                width: 60vw;
            "
        >
            <div
                id="levelContainer"
                style="
                    display: flex;
                    flex-direction: column;
                    width: 12rem;
                    padding: 0.25rem;
                    align-items: end;
                    gap: 0.25rem;
                "
            ></div>
            <div
                id="gameContainer"
                style="
                    display: flex;
                    flex-direction: column;
                    width: 100%;
                    align-items: center;
                "
            >
                <div
                    id="gameStage"
                    style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    "
                >
                    No level loaded, try to start a level on your left.
                </div>
                <div id="gameEmulatedTerminal">
                    <!-- so here is the core / the only way to interact with the board -->
                    <textarea
                        id="terminalDisplay"
                        class="mono"
                        rows="12"
                        cols="80"
                        readonly
                        resize="none"
                    ></textarea>
                    <br />
                    &gt;
                    <input
                        type="text"
                        id="terminalInput"
                        class="mono"
                        style="width: 40rem;"
                        placeholder="Enter commands."
                    />
                </div>
            </div>
        </div>

        <!-- page manipulation goes here -->
        <script>
        // init and display the levels
        document.querySelector("#levelContainer").innerHTML =
                `<h2 class="bitcount">Levels</h2>` +
                levels
                    .map(
                        (level) =>
                            `<div class="level">
                            <button class="play-button" onclick="startLevel('${level.id}')">Load ${level.name}</button>
                            </div>`,
                    )
                    .join("");

        </script>

        <!-- the actual logic goes here -->
        <script>
            function startLevel(id) {
              // flags about is the level loaded or nah
              let flag = false;
              // first we need to have a way to recognize the level's size & basic info
                for (let i = 0; i < levels.length; i++) {
                    // skip the other levels
                    if (levels[i].id !== id) continue;
                    let level = levels[i];
                    loadedLevel = level;
                    flag = true;

                    // generate the table for game field
                    // we need to generate the chess board for the actuall field
                    // and adding some extra border for a easier "failing" detection
                    let table = document.createElement("table");
                    // table.style.border = '1px solid black';
                    table.style.borderCollapse = "collapse";

                    for (let y = -1; y < levels[i].height + 1; y++) {
                        let row = document.createElement("tr");
                        for (let x = -1; x < levels[i].width + 1; x++) {
                            let cell = document.createElement("td");

                            cell.style.border = "1px solid black";
                            cell.style.width = "2rem";
                            cell.style.height = "2rem";

                            if (
                                x === -1 ||
                                y === -1 ||
                                x === level.width ||
                                y === level.height
                            ) {
                                cell.style.border = "0px";
                            }
                            row.appendChild(cell);
                        }
                        table.appendChild(row);
                    }


                    // now we need to put the object into the table
                    for (let i = 0; i < level.objects.length; i++) {
                        let obj = level.objects[i];
                        let cell = table.rows[obj.y + 1].cells[obj.x + 1];
                        cell.style.textAlign = "center";
                        cell.innerHTML = obj.symbol;
                    }

                    document.querySelector("#gameStage").innerHTML =
                        level.description;
                    document.querySelector("#gameStage").appendChild(table);
                }
                return flag;
            }

            function terminalEvent(input) {

              textarea.value += '\n\n> ' + input + '\n';

              let baseCommand = input.split(' ')[0];
              switch(baseCommand) {
                case "help":
                  let action = input.split(' ')[1];
                  switch(action){
                    case "level":
                      textarea.value += `Available commands for ${action}:\n`;
                      textarea.value += 'info - display the current level info\n';
                      textarea.value += 'load <ID> - load the specific level\n';
                      textarea.value += 'restart - restart this level\n';
                    break;
                    default:
                      textarea.value += 'Available commands:\n';
                      textarea.value += 'help - display this message\n';

                  }
                  break;
                case "level":
                  let action = input.split(' ')[1];
                  switch(action) {
                    case "info":
                      if(loadedLevel.id === undefined){
                        textarea.value += 'You are not in any levels.\n'
                      } else {
                        textarea.value += `You are in ${loadedLevel.name}(${loadedLevel.id}) now.\n`;
                      }
                      break;
                    case "load":
                      let levelID = input.split(' ')[2];
                      if(startLevel(levelID)){
                        textarea.value += 'Level loaded successfully!\n';
                      } else {
                        textarea.value += `Level ${levelID} is not loaded, is the ID correct?\n`
                      }
                      break;
                    case "restart":
                      textarea.value += `Restarting...`;
                      startLevel(loadedLevel.id);
                    default:
                      textarea.value += 'Unknown level action. Try to use \'help <command>\' to get the usage.';
                  }
                  break;
                default:
                  textarea.value += 'Unknown command. Try to use \'help\' to get the basic commands.';
              }

              textarea.scrollTop = textarea.scrollHeight;
            }

            // bind the "Submit" to the input
            let input = document.querySelector('#terminalInput');
                input.addEventListener('keydown', (event) => {
                    let key = event.key;
                    if (key === "Enter") {
                        terminalEvent(input.value);
                        input.value = '';
                    }
                });
        </script>
    </body>
</html>
